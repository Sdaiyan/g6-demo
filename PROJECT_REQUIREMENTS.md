# G6 网络图可视化系统需求文档

## 项目概述
基于 Vue3 + Vite + TypeScript + SCSS 技术栈，使用 G6 图可视化库实现一个节点网状关系展示系统的 Demo。适用于PC端。宽度默认撑满屏幕。

## 准备工作
了解 g6 最新版 api https://g6.antv.antgroup.com/api/data
g6 一些 sample 示例 https://g6.antv.antgroup.com/examples

## 技术栈要求
- **前端框架**: Vue3 + Vite
- **开发语言**: TypeScript
- **样式语言**: SCSS
- **图可视化**: G6 最新版本
- **状态管理**: Pinia (Vue3生态)
- **UI组件**: Element Plus

## 功能需求

### 1. 节点数据模型设计
- **基础属性**: 节点名称(必须)、描述(必须)
- **自定义属性**: 支持字符串、数字、布尔值、日期等多种数据类型
- **关系属性**: 支持单向、双向、带权重的节点关系
- **层级结构**: 支持父子节点的层级关系

### 2. 随机数据生成器
- **参数化生成**: 可配置各级节点数量范围
- **属性随机化**: 使用 Faker.js 自动生成真实感的随机节点属性值
- **关系生成**: 随机生成节点间的指向关系（包括跨层级关系）
- **数据验证**: 确保生成的数据结构合理
- **多语言支持**: 支持中文等多种语言的模拟数据生成

### 3. 图形渲染与交互
使用 g6 自带即可

### 4. 节点详情展示
- **右侧面板**: 节点高亮时显示详情信息
- **属性展示**: 显示节点的所有自定义属性
- **关系节点**: 展示与当前节点存在关系的相关节点列表

### 5. 搜索与导航
- **智能搜索**: 基于节点名称的搜索功能
- **自动补全**: 实时显示匹配的节点建议
- **快速定位**: 点击搜索结果高亮并定位到目标节点

## 执行步骤

### 第一阶段：项目初始化与环境配置

#### 1. 创建项目基础结构
```bash
npm create vue@latest . -- --typescript --router --pinia --with-tests --eslint
```

#### 2. 安装核心依赖
```bash
# G6 相关
npm install @antv/g6@latest

# Vue 生态
npm install pinia vue-router@4

# UI 组件库
npm install element-plus @element-plus/icons-vue

# 工具库
npm install lodash-es @types/lodash-es

# 假数据生成库
npm install @faker-js/faker

# 开发依赖
npm install --save-dev sass @types/node
```

### 第二阶段：数据模型与类型定义

#### 1. 定义核心数据类型
- **NodeData**: 节点数据
- **NodeAttribute**: 节点属性

#### 2. 实现数据生成器
- **generateRandomNodes**: 使用 Faker.js 生成真实感的随机节点数据（姓名、公司、邮箱等）
- **generateRandomEdges**: 关系网络构建逻辑
- **validateGraphData**: 数据验证函数
- **多类型属性生成**: 集成 Faker.js 生成各种类型的模拟数据（人员信息、地址、日期、产品等）

### 第三阶段：G6 集成与基础图形渲染

#### 1. 研究G6最新API
- 查阅 G6 v5 官方文档
- 了解新版本的变化和最佳实践
- 确定组件设计方案

#### 2. 实现2D图组件
- 使用 G6 v5.x 最新版本
- 采用 d3-force 布局算法
- 实现层次化网络布局优化

#### 3. G6 布局优化配置 (重要参考)

基于以下示例代码的布局逻辑，实现父子节点距离和斥力的优化配置：

```javascript
// G6 v5 层次化布局参考示例
const graph = new Graph({
  container: 'container',
  data,
  node: {
    style: {
      size: (d) => d.size, // 根据节点层级动态设置大小
    },
  },
  layout: {
    type: 'd3-force',
    link: {
      distance: (d) => {
        if (d.source.id === 'node0') {
          return 100; // 根节点到第一层距离
        }
        return 30; // 其他层级节点距离
      },
      strength: (d) => {
        if (d.source.id === 'node1' || d.source.id === 'node2' || d.source.id === 'node3') {
          return 0.7; // 中间层节点连接强度
        }
        return 0.1; // 叶子节点连接强度
      },
    },
    manyBody: {
      strength: (d) => {
        if (d.isLeaf) {
          return -50; // 叶子节点斥力
        }
        return -10; // 其他节点斥力
      },
    },
  },
  behaviors: ['drag-element-force'],
});
```

**关键优化点**：
- **连接距离**: 根节点100px，其他30px，确保层次清晰
- **连接强度**: 中间层0.7（紧密），叶子节点0.1（松散）
- **节点斥力**: 叶子节点-50（紧密排列），其他-10（适中间距）
- **节点大小**: 根节点50px，中间层30px，叶子15px
- **动态参数**: 所有参数根据节点类型和层级动态计算

### 第四阶段：交互功能实现

#### 1. 节点选择与高亮系统
- 点击事件处理机制
- 节点高亮状态管理
- 相关节点标识逻辑

#### 2. 详情面板开发
- 响应式属性展示
- 关系节点列表组件
- 面板显示/隐藏动画

#### 3. 搜索功能实现
- 高效的搜索算法
- 实时自动补全
- 搜索结果高亮定位

## 假数据生成策略

### Faker.js 集成方案
- **库选择**: 使用 @faker-js/faker 作为主要的假数据生成库
- **数据类型覆盖**: 
  - 人员信息：姓名、邮箱、电话、头像
  - 组织信息：公司名、部门、职位
  - 地理信息：城市、地址、坐标
  - 时间信息：创建时间、更新时间、截止日期
  - 业务信息：产品名、价格、状态、优先级
- **本地化支持**: 支持中文数据生成，提升Demo的真实感
- **种子控制**: 可设置随机种子，确保数据生成的可重现性

### 数据生成规则
- **节点命名**: 使用真实的人名或公司名
- **属性多样性**: 每个节点包含5-10个不同类型的属性
- **关系权重**: 基于业务逻辑生成合理的权重值
- **层级结构**: 模拟真实的组织架构或项目关系

### Faker.js 使用示例
```typescript
import { faker } from '@faker-js/faker';

// 生成节点数据示例
const generateNodeData = () => ({
  id: faker.string.uuid(),
  name: faker.person.fullName(),
  description: faker.company.catchPhrase(),
  attributes: {
    email: faker.internet.email(),
    phone: faker.phone.number(),
    department: faker.commerce.department(),
    position: faker.person.jobTitle(),
    company: faker.company.name(),
    address: faker.location.streetAddress(),
    joinDate: faker.date.past(),
    salary: faker.number.int({ min: 3000, max: 50000 }),
    active: faker.datatype.boolean(),
    avatar: faker.image.avatar(),
    tags: faker.helpers.arrayElements(['重要', '紧急', '普通'], 2)
  }
});
```

## 技术难点与解决方案

### 1. G6 版本兼容性
**问题**: G6 v5 相较于 v4 有较大API变化
**解决方案**: 
- 详细研究官方文档和示例
- 使用新版 API 进行开发：`new Graph()` 替代旧版配置
- 数据格式适配：节点数据需要包装在 `data` 属性中

### 2. 层次化布局优化
**问题**: 如何实现美观且符合层次关系的网络布局
**解决方案**:
- 采用 d3-force 布局算法
- 动态调整连接距离：根节点100px，叶子节点30px
- 智能设置连接强度：中间层0.7，叶子节点0.1
- 分层斥力配置：叶子节点-50，根节点-200，中间层-100
- 节点大小层次化：根节点50px，中间层30px，叶子15px

### 3. 渲染性能
**问题**: 大量节点的渲染可能存在性能瓶颈
**解决方案**:
- 实现LOD（Level of Detail）技术
- 节点数量阈值控制
- WebGL优化策略
- 数据有效性检查，避免无效渲染

### 4. 搜索性能优化
**问题**: 大量节点时的搜索性能
**解决方案**:
- 实现倒排索引
- 使用 Web Workers 进行后台搜索
- 搜索结果缓存机制

### 5. 状态管理错误处理
**问题**: G6 元素状态操作时可能出现 undefined ID 错误
**解决方案**:
- 添加数据有效性检查
- try-catch 错误处理机制
- 安全的状态设置函数

## 验收标准

### 功能完整性
- [ ] 节点详情面板正常显示
- [ ] 搜索功能工作正常
- [ ] Faker.js 生成真实感的模拟数据
- [ ] 支持中文数据生成

### 性能指标
- [ ] 1000个节点渲染时间 < 2秒
- [ ] 搜索响应时间 < 500ms
- [ ] 内存使用稳定

### 用户体验
- [ ] 界面美观易用
- [ ] 交互响应及时
- [ ] 错误处理完善

## 注意事项

1. **API研究优先**: 必须先深入了解G6 v5的API变化
2. **布局优化**: 参考层次化布局示例，合理设置节点距离、连接强度和斥力参数
3. **性能考虑**: 时刻关注大数据量下的性能表现
4. **代码质量**: 保持代码结构清晰，便于维护和扩展
5. **用户体验**: 确保所有交互都流畅自然
6. **浏览器兼容**: 确保在主流浏览器中正常工作
7. **错误处理**: 完善的错误处理和用户提示机制，特别注意 G6 状态操作的安全性
8. **真实数据**: 使用 Faker.js 确保生成的模拟数据具有真实感和多样性
9. **数据验证**: 确保传递给 G6 的数据格式正确，避免 undefined ID 等错误

---

## 实施总结

### 已完成功能

#### ✅ 项目架构
- Vue3 + Vite + TypeScript + SCSS 技术栈搭建完成
- Element Plus UI 组件库集成
- Pinia 状态管理配置
- 完整的类型定义系统

#### ✅ 数据生成系统
- Faker.js 集成，支持中文/英文数据生成
- 多类型节点属性生成（人员、公司、产品、地点）
- 层次化数据结构生成
- 智能父子关系构建

#### ✅ G6 图可视化
- G6 v5 最新版本集成
- 层次化 d3-force 布局优化
- 动态节点大小和颜色配置
- 智能连接距离和斥力设置
- 完善的错误处理机制

#### ✅ 交互功能
- 节点点击、悬停事件
- 智能搜索和自动补全
- 节点详情面板展示
- 搜索结果高亮定位

#### ✅ 用户界面
- 响应式布局设计
- 美观的组件样式
- 清晰的信息展示

### 核心技术亮点

1. **层次化布局算法**: 根据节点层级智能调整布局参数
2. **真实感数据生成**: 使用 Faker.js 生成具有真实感的模拟数据
3. **高性能搜索**: 基于倒排索引的快速搜索算法
4. **错误处理机制**: 完善的数据验证和异常处理
5. **模块化架构**: 清晰的代码结构，易于维护和扩展

### 部署信息
- 开发服务器: http://localhost:5174/
- 热更新支持: 实时代码修改反馈
- 调试模式: 浏览器控制台输出详细信息
